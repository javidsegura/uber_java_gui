<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TeeTime - Simplified System Diagrams (Phase 1)</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        header p {
            font-size: 1.2em;
            opacity: 0.95;
        }
        
        .badge {
            display: inline-block;
            background: #4caf50;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-top: 10px;
            font-weight: bold;
        }
        
        nav {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 3px solid #667eea;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }
        
        nav button {
            background: white;
            border: 2px solid #667eea;
            color: #667eea;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        nav button:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        nav button.active {
            background: #667eea;
            color: white;
        }
        
        .content {
            padding: 40px;
        }
        
        .diagram-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .diagram-section.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .diagram-header {
            margin-bottom: 30px;
        }
        
        .diagram-header h2 {
            font-size: 2.5em;
            color: #667eea;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 3px solid #667eea;
        }
        
        .diagram-header .description {
            font-size: 1.1em;
            color: #666;
            line-height: 1.8;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #667eea;
        }
        
        .diagram-container {
            background: #fafafa;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
            border: 2px solid #e0e0e0;
            overflow-x: auto;
        }
        
        .mermaid {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 400px;
        }
        
        .implementation-notes {
            background: #e8f5e9;
            padding: 25px;
            border-radius: 10px;
            margin-top: 30px;
            border-left: 5px solid #4caf50;
        }
        
        .implementation-notes h3 {
            color: #2e7d32;
            margin-bottom: 15px;
            font-size: 1.5em;
        }
        
        .implementation-notes ul {
            list-style: none;
            padding-left: 0;
        }
        
        .implementation-notes li {
            padding: 10px 0;
            padding-left: 30px;
            position: relative;
        }
        
        .implementation-notes li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #4caf50;
            font-weight: bold;
            font-size: 1.2em;
        }
        
        .warning-box {
            background: #fff3e0;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border-left: 5px solid #ff9800;
        }
        
        .warning-box h4 {
            color: #e65100;
            margin-bottom: 10px;
        }
        
        footer {
            background: #2c3e50;
            color: white;
            text-align: center;
            padding: 30px;
            margin-top: 40px;
        }
        
        @media (max-width: 768px) {
            header h1 {
                font-size: 2em;
            }
            
            .content {
                padding: 20px;
            }
            
            nav {
                padding: 15px;
            }
            
            nav button {
                padding: 10px 15px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üöó TeeTime</h1>
            <p>Campus Ride-Sharing Platform - Phase 1 Design</p>
            <span class="badge">SIMPLIFIED CORE VERSION</span>
        </header>
        
        <nav id="navbar">
            <button onclick="showDiagram('class')" class="active">Class Diagram</button>
            <button onclick="showDiagram('er')">ER Diagram</button>
            <button onclick="showDiagram('usecase')">Use Cases</button>
            <button onclick="showDiagram('sequence')">Sequence</button>
            <button onclick="showDiagram('architecture')">Architecture</button>
            <button onclick="showDiagram('state')">State Diagram</button>
            <button onclick="showDiagram('activity')">Activity Flow</button>
        </nav>
        
        <div class="content">
            <!-- Class Diagram -->
            <div id="class-diagram" class="diagram-section active">
                <div class="diagram-header">
                    <h2>UML Class Diagram (Core)</h2>
                    <div class="description">
                        <p><strong>Focus:</strong> This simplified class diagram shows only the essential classes needed for Phase 1 implementation. It demonstrates the core Passenger-Driver matching workflow with proper OOP principles.</p>
                        <p><strong>Key Components:</strong> Abstract User class, Passenger and Driver subclasses, Car and Ride entities, RideStatus enum, service layer (AuthService, RideService), DAO pattern for persistence, and custom exceptions.</p>
                    </div>
                </div>
                
                <div class="diagram-container">
                    <div class="mermaid">
classDiagram
    %% Core Abstract Class
    class User {
        <<abstract>>
        #int userId
        #String name
        #String email
        #String passwordHash
        #String role
        +login() boolean
        +logout() void
        +updateProfile() void
        +switchRole(newRole) void
    }

    %% User Subclasses
    class Passenger {
        -List~Ride~ myRides
        +createRideRequest(origin, destination, time, seats) Ride
        +viewMyRequests() List~Ride~
        +cancelRequest(rideId) boolean
        +viewRideHistory() List~Ride~
    }

    class Driver {
        -List~Car~ myCars
        -boolean isAvailable
        +addCar(carDetails) Car
        +removeCar(carId) boolean
        +viewOpenRequests() List~Ride~
        +acceptRide(rideId) boolean
        +declineRide(rideId) boolean
        +markRideComplete(rideId) void
        +viewMyAcceptedRides() List~Ride~
    }

    %% Core Entity Classes
    class Car {
        -int carId
        -int driverId
        -String licensePlate
        -String brand
        -String model
        -int seatingCapacity
        +getAvailableSeats() int
        +isAvailable() boolean
    }

    class Ride {
        -int rideId
        -int passengerId
        -int driverId
        -int carId
        -String origin
        -String destination
        -DateTime requestTime
        -DateTime scheduledTime
        -int seatsNeeded
        -double priceEstimate
        -RideStatus status
        +calculatePrice() double
        +assignDriver(driver, car) void
        +updateStatus(status) void
    }

    class RideStatus {
        <<enumeration>>
        PENDING
        CONFIRMED
        COMPLETED
        CANCELLED
    }

    %% Service Layer
    class AuthService {
        -DatabaseManager db
        +register(name, email, password, role) User
        +login(email, password) User
        +logout(userId) void
        +validateEmail(email) boolean
        +hashPassword(password) String
        +switchUserRole(userId, newRole) void
    }

    class RideService {
        -DatabaseManager db
        +createRideRequest(passengerDetails) Ride
        +listOpenRequests() List~Ride~
        +acceptRide(rideId, driverId, carId) boolean
        +markRideComplete(rideId) void
        +getRidesByPassenger(passengerId) List~Ride~
        +getRidesByDriver(driverId) List~Ride~
        +cancelRide(rideId) boolean
        +calculatePriceEstimate(origin, destination) double
    }

    %% Data Access Layer
    class DatabaseManager {
        -Connection connection
        -String dbUrl
        +connect() boolean
        +disconnect() void
        +executeQuery(sql) ResultSet
        +executeUpdate(sql) int
        +beginTransaction() void
        +commit() void
        +rollback() void
    }

    class UserDAO {
        -DatabaseManager db
        +save(user) boolean
        +findById(id) User
        +findByEmail(email) User
        +update(user) boolean
        +delete(id) boolean
    }

    class RideDAO {
        -DatabaseManager db
        +save(ride) boolean
        +findById(id) Ride
        +findPendingRides() List~Ride~
        +findByPassenger(passengerId) List~Ride~
        +findByDriver(driverId) List~Ride~
        +update(ride) boolean
    }

    class CarDAO {
        -DatabaseManager db
        +save(car) boolean
        +findById(id) Car
        +findByDriver(driverId) List~Car~
        +update(car) boolean
        +delete(id) boolean
    }

    %% Custom Exceptions
    class InvalidLoginException {
        <<exception>>
        +InvalidLoginException(message)
    }

    class CapacityExceededException {
        <<exception>>
        +CapacityExceededException(message)
    }

    class DatabaseException {
        <<exception>>
        +DatabaseException(message, cause)
    }

    %% Utility
    class CSVExporter {
        +exportRideHistory(userId, filepath) void
        +exportCarList(driverId, filepath) void
    }

    %% Relationships
    User <|-- Passenger
    User <|-- Driver
    
    Driver "1" --> "0..*" Car : owns
    Passenger "1" --> "0..*" Ride : requests
    Driver "0..1" --> "0..*" Ride : accepts
    Ride "1" --> "1" Car : uses
    Ride "1" --> "1" RideStatus : has

    AuthService --> User : manages
    AuthService --> UserDAO : uses
    AuthService --> DatabaseManager : uses
    
    RideService --> Ride : manages
    RideService --> RideDAO : uses
    RideService --> CarDAO : uses
    RideService --> DatabaseManager : uses
    
    UserDAO --> DatabaseManager : uses
    RideDAO --> DatabaseManager : uses
    CarDAO --> DatabaseManager : uses
    
    RideService ..> CapacityExceededException : throws
    AuthService ..> InvalidLoginException : throws
    DatabaseManager ..> DatabaseException : throws
    
    CSVExporter --> Ride : exports
    CSVExporter --> Car : exports
                    </div>
                </div>
                
                <div class="implementation-notes">
                    <h3>‚úÖ Phase 1 Class Count: 13+ Classes</h3>
                    <ul>
                        <li><strong>Entities (5):</strong> User (abstract), Passenger, Driver, Car, Ride</li>
                        <li><strong>Enum (1):</strong> RideStatus</li>
                        <li><strong>Services (2):</strong> AuthService, RideService</li>
                        <li><strong>DAOs (4):</strong> DatabaseManager, UserDAO, RideDAO, CarDAO</li>
                        <li><strong>Exceptions (3):</strong> InvalidLoginException, CapacityExceededException, DatabaseException</li>
                        <li><strong>Utilities (1):</strong> CSVExporter</li>
                    </ul>
                </div>
                
                <div class="warning-box">
                    <h4>‚ö†Ô∏è Removed for Simplicity:</h4>
                    <p>Payment classes, Rating system, Admin features, Notification service, Wallet, Disputes - these can be added later as Phase 2 extensions!</p>
                </div>
            </div>
            
            <!-- ER Diagram -->
            <div id="er-diagram" class="diagram-section">
                <div class="diagram-header">
                    <h2>Entity-Relationship Diagram</h2>
                    <div class="description">
                        <p><strong>Focus:</strong> Minimal 3-table database schema that satisfies all core requirements. Clean, normalized design with proper foreign keys and constraints.</p>
                        <p><strong>Tables:</strong> USERS (all user types), CARS (driver vehicles), RIDES (request/match data)</p>
                    </div>
                </div>
                
                <div class="diagram-container">
                    <div class="mermaid">
erDiagram
    USERS ||--o{ RIDES_AS_PASSENGER : "requests"
    USERS ||--o{ RIDES_AS_DRIVER : "accepts"
    USERS ||--o{ CARS : "owns"
    CARS ||--o{ RIDES : "used_in"
    
    USERS {
        int user_id PK "Auto-increment primary key"
        string name "User full name"
        string email UK "University email (unique)"
        string password_hash "Hashed password"
        string role "PASSENGER, DRIVER, or BOTH"
        datetime created_at "Account creation timestamp"
    }
    
    CARS {
        int car_id PK "Auto-increment primary key"
        int driver_id FK "References USERS(user_id)"
        string license_plate UK "Unique plate number"
        string brand "Car manufacturer"
        string model "Car model"
        int seating_capacity "Total seats (1-8)"
        datetime registered_at "Car registration timestamp"
    }
    
    RIDES {
        int ride_id PK "Auto-increment primary key"
        int passenger_id FK "References USERS(user_id)"
        int driver_id FK "References USERS(user_id), nullable until accepted"
        int car_id FK "References CARS(car_id), nullable until accepted"
        string origin "Starting location"
        string destination "End location"
        datetime request_time "When passenger created request"
        datetime scheduled_time "When ride should happen"
        int seats_needed "Number of seats passenger needs"
        decimal price_estimate "Estimated cost (simple calculation)"
        string status "PENDING, CONFIRMED, COMPLETED, CANCELLED"
    }
                    </div>
                </div>
                
                <div class="implementation-notes">
                    <h3>‚úÖ Database Features</h3>
                    <ul>
                        <li><strong>3 Tables:</strong> Meets requirement for 3-5 related tables</li>
                        <li><strong>Normalized:</strong> No redundant data, proper foreign keys</li>
                        <li><strong>Flexible Roles:</strong> Single users table with role field (can be BOTH)</li>
                        <li><strong>NULL Handling:</strong> driver_id and car_id nullable in PENDING rides</li>
                        <li><strong>Simple but Complete:</strong> Captures all essential ride-matching data</li>
                    </ul>
                </div>
            </div>
            
            <!-- Use Case Diagram -->
            <div id="usecase-diagram" class="diagram-section">
                <div class="diagram-header">
                    <h2>Use Case Diagram</h2>
                    <div class="description">
                        <p><strong>Focus:</strong> Core interactions for Passenger-Driver matching workflow. Shows role flexibility and shared functionality.</p>
                    </div>
                </div>
                
                <div class="diagram-container">
                    <div class="mermaid">
graph TB
    subgraph System["TeeTime Ride-Sharing System"]
        subgraph PassengerCases["Passenger Use Cases"]
            UC1[Register Account]
            UC2[Login/Logout]
            UC3[Create Ride Request]
            UC4[View My Requests]
            UC5[Cancel Pending Request]
            UC6[View Ride History]
            UC7[Switch to Driver Role]
        end
        
        subgraph DriverCases["Driver Use Cases"]
            UC8[Add Car]
            UC9[Remove Car]
            UC10[View My Cars]
            UC11[View Open Ride Requests]
            UC12[Accept Ride Request]
            UC13[Decline Ride Request]
            UC14[View My Accepted Rides]
            UC15[Mark Ride Complete]
            UC16[Switch to Passenger Role]
        end
        
        subgraph SharedCases["Shared Functions"]
            UC17[Update Profile]
            UC18[Export Ride History CSV]
        end
    end
    
    Passenger((Passenger<br/>Student/Staff))
    Driver((Driver<br/>Car Owner))
    Email[Email System]
    
    Passenger --> UC1
    Passenger --> UC2
    Passenger --> UC3
    Passenger --> UC4
    Passenger --> UC5
    Passenger --> UC6
    Passenger --> UC7
    Passenger --> UC17
    Passenger --> UC18
    
    Driver --> UC8
    Driver --> UC9
    Driver --> UC10
    Driver --> UC11
    Driver --> UC12
    Driver --> UC13
    Driver --> UC14
    Driver --> UC15
    Driver --> UC16
    Driver --> UC3
    Driver --> UC4
    Driver --> UC6
    Driver --> UC17
    Driver --> UC18
    
    UC1 -.->|sends verification| Email
    
    UC3 -->|requires login| UC2
    UC12 -->|updates| UC3
    UC15 -->|requires| UC12
    UC7 -->|changes role| UC1
    UC16 -->|changes role| UC1
    
    style Passenger fill:#e1f5ff
    style Driver fill:#fff4e1
    style Email fill:#f0f0f0
    style PassengerCases fill:#e8f4f8
    style DriverCases fill:#fff9e6
    style SharedCases fill:#f0f0f0
                    </div>
                </div>
                
                <div class="implementation-notes">
                    <h3>‚úÖ Key Features</h3>
                    <ul>
                        <li><strong>Role Flexibility:</strong> Same user can be Passenger, Driver, or both</li>
                        <li><strong>Core Workflow:</strong> Create ‚Üí View ‚Üí Accept ‚Üí Complete</li>
                        <li><strong>File I/O:</strong> CSV export functionality</li>
                        <li><strong>18 Use Cases:</strong> Focused on essential features only</li>
                    </ul>
                </div>
            </div>
            
            <!-- Sequence Diagram -->
            <div id="sequence-diagram" class="diagram-section">
                <div class="diagram-header">
                    <h2>Sequence Diagram - Ride Matching Flow</h2>
                    <div class="description">
                        <p><strong>Focus:</strong> Complete interaction flow showing how a Passenger request gets matched with a Driver. Includes capacity validation and exception handling.</p>
                    </div>
                </div>
                
                <div class="diagram-container">
                    <div class="mermaid">
sequenceDiagram
    actor P as Passenger
    participant UI as JavaFX UI
    participant Auth as AuthService
    participant RS as RideService
    participant DB as DatabaseManager
    participant D as Driver
    
    Note over P,D: 1. Passenger Login & Ride Request
    P->>UI: Login (email, password)
    UI->>Auth: login(email, password)
    Auth->>DB: Query user by email
    DB-->>Auth: User data
    Auth->>Auth: Verify password hash
    Auth-->>UI: User object (role: PASSENGER)
    UI-->>P: Show Passenger Dashboard
    
    P->>UI: Create ride request<br/>(origin, destination, time, seats)
    UI->>RS: createRideRequest(passengerDetails)
    RS->>RS: validateRequest()
    RS->>RS: calculatePriceEstimate()
    RS->>DB: INSERT INTO rides (status=PENDING)
    DB-->>RS: ride_id
    RS-->>UI: Ride created successfully
    UI-->>P: "Request submitted! Waiting for driver..."
    
    Note over P,D: 2. Driver Views & Accepts Request
    D->>UI: Login (email, password)
    UI->>Auth: login(email, password)
    Auth->>DB: Query user by email
    DB-->>Auth: User data
    Auth-->>UI: User object (role: DRIVER)
    UI-->>D: Show Driver Dashboard
    
    D->>UI: View open ride requests
    UI->>RS: listOpenRequests()
    RS->>DB: SELECT * FROM rides WHERE status=PENDING
    DB-->>RS: List of pending rides
    RS-->>UI: Pending rides with details
    UI-->>D: Display requests table
    
    D->>UI: Accept ride (select car)
    UI->>RS: acceptRide(rideId, driverId, carId)
    RS->>DB: SELECT seating_capacity FROM cars WHERE car_id=?
    DB-->>RS: Car capacity
    
    alt Capacity sufficient
        RS->>RS: Validate: car.capacity >= ride.seatsNeeded
        RS->>DB: BEGIN TRANSACTION
        RS->>DB: UPDATE rides SET driver_id=?, car_id=?, status=CONFIRMED
        RS->>DB: COMMIT
        DB-->>RS: Success
        RS-->>UI: Ride accepted!
        UI-->>D: "Ride confirmed! Details: ..."
        UI->>P: Notification: "Driver found!"
    else Capacity exceeded
        RS->>RS: Throw CapacityExceededException
        RS-->>UI: Error: "Car doesn't have enough seats"
        UI-->>D: Show error message
    end
    
    Note over P,D: 3. Ride Completion
    D->>UI: Mark ride complete
    UI->>RS: markRideComplete(rideId)
    RS->>DB: UPDATE rides SET status=COMPLETED
    DB-->>RS: Success
    RS-->>UI: Ride marked complete
    UI-->>D: "Ride completed successfully"
    
    Note over P,D: 4. Export History
    P->>UI: Export my ride history
    UI->>RS: getRidesByPassenger(passengerId)
    RS->>DB: SELECT * FROM rides WHERE passenger_id=?
    DB-->>RS: Passenger's rides
    RS-->>UI: Ride list
    UI->>UI: CSVExporter.exportRideHistory()
    UI-->>P: Download rides.csv
                    </div>
                </div>
                
                <div class="implementation-notes">
                    <h3>‚úÖ Covered Requirements</h3>
                    <ul>
                        <li><strong>Exception Handling:</strong> CapacityExceededException shown</li>
                        <li><strong>Database Operations:</strong> Transactions, queries, updates</li>
                        <li><strong>File I/O:</strong> CSV export at the end</li>
                        <li><strong>Service Layer Logic:</strong> Validation, price calculation</li>
                    </ul>
                </div>
            </div>
            
            <!-- Architecture Diagram -->
            <div id="architecture-diagram" class="diagram-section">
                <div class="diagram-header">
                    <h2>System Architecture</h2>
                    <div class="description">
                        <p><strong>Focus:</strong> Clean 4-layer architecture with clear separation of concerns. Shows DAO pattern and service layer.</p>
                    </div>
                </div>
                
                <div class="diagram-container">
                    <div class="mermaid">
graph TB
    subgraph PresentationLayer["Presentation Layer - JavaFX"]
        LoginView[Login/Register Screen]
        PassengerDash[Passenger Dashboard<br/>- Create Request<br/>- My Requests<br/>- History]
        DriverDash[Driver Dashboard<br/>- My Cars<br/>- Open Requests<br/>- My Accepted Rides]
    end
    
    subgraph BusinessLayer["Business Logic Layer"]
        AuthService[AuthService<br/>- Login/Register<br/>- Email validation<br/>- Role switching]
        RideService[RideService<br/>- Create/Accept rides<br/>- List requests<br/>- Calculate price<br/>- Complete rides]
        CSVExporter[CSVExporter<br/>- Export ride history]
    end
    
    subgraph DataAccessLayer["Data Access Layer - DAO Pattern"]
        UserDAO[UserDAO]
        RideDAO[RideDAO]
        CarDAO[CarDAO]
        DatabaseManager[DatabaseManager<br/>- Connection pool<br/>- Transactions]
    end
    
    subgraph DataLayer["Data Layer"]
        Database[(MySQL/PostgreSQL<br/>Tables:<br/>- users<br/>- cars<br/>- rides)]
        FileSystem[File System<br/>- CSV exports<br/>- Logs]
    end
    
    subgraph External["External"]
        EmailService[Email Service<br/>verification only]
    end
    
    LoginView --> AuthService
    PassengerDash --> RideService
    DriverDash --> RideService
    DriverDash --> CSVExporter
    PassengerDash --> CSVExporter
    
    AuthService --> UserDAO
    RideService --> RideDAO
    RideService --> CarDAO
    
    UserDAO --> DatabaseManager
    RideDAO --> DatabaseManager
    CarDAO --> DatabaseManager
    
    DatabaseManager --> Database
    CSVExporter --> FileSystem
    
    AuthService -.-> EmailService
    
    style PresentationLayer fill:#e1f5ff
    style BusinessLayer fill:#fff4e1
    style DataAccessLayer fill:#e8f5e8
    style DataLayer fill:#f0f0f0
    style External fill:#ffe1f0
                    </div>
                </div>
                
                <div class="implementation-notes">
                    <h3>‚úÖ Architecture Highlights</h3>
                    <ul>
                        <li><strong>4 Clear Layers:</strong> Presentation, Business, Data Access, Data</li>
                        <li><strong>DAO Pattern:</strong> Separates persistence logic from business logic</li>
                        <li><strong>Single Responsibility:</strong> Each class has one clear purpose</li>
                        <li><strong>Testable:</strong> Service layer can be unit tested independently</li>
                    </ul>
                </div>
            </div>
            
            <!-- State Diagram -->
            <div id="state-diagram" class="diagram-section">
                <div class="diagram-header">
                    <h2>State Diagram - Ride Lifecycle</h2>
                    <div class="description">
                        <p><strong>Focus:</strong> Simplified 4-state lifecycle (PENDING ‚Üí CONFIRMED ‚Üí COMPLETED, with CANCELLED path)</p>
                    </div>
                </div>
                
                <div class="diagram-container">
                    <div class="mermaid">
stateDiagram-v2
    [*] --> PENDING: Passenger creates ride request
    
    PENDING --> CONFIRMED: Driver accepts with valid car
    PENDING --> CANCELLED: Passenger cancels<br/>or 24h timeout
    
    CONFIRMED --> COMPLETED: Driver marks complete
    CONFIRMED --> CANCELLED: Passenger or Driver cancels
    
    COMPLETED --> [*]
    CANCELLED --> [*]
    
    note right of PENDING
        - Ride request created
        - Visible to all drivers
        - driver_id and car_id are NULL
        - Auto-cancel after 24 hours
    end note
    
    note right of CONFIRMED
        - Driver and car assigned
        - driver_id and car_id populated
        - Passenger notified
        - Ready for pickup
    end note
    
    note right of COMPLETED
        - Ride finished
        - Can be exported to CSV
        - Visible in history
    end note
    
    note right of CANCELLED
        - Ride terminated
        - Reason recorded
        - Visible in history
    end note
                    </div>
                </div>
                
                <div class="implementation-notes">
                    <h3>‚úÖ State Management</h3>
                    <ul>
                        <li><strong>4 States:</strong> PENDING, CONFIRMED, COMPLETED, CANCELLED</li>
                        <li><strong>Clear Transitions:</strong> Well-defined rules for state changes</li>
                        <li><strong>Enum Implementation:</strong> Use RideStatus enum in code</li>
                        <li><strong>Validation:</strong> Prevent invalid state transitions</li>
                    </ul>
                </div>
            </div>
            
            <!-- Activity Diagram -->
            <div id="activity-diagram" class="diagram-section">
                <div class="diagram-header">
                    <h2>Activity Diagram - End-to-End Flow</h2>
                    <div class="description">
                        <p><strong>Focus:</strong> Complete workflow from passenger request creation through driver acceptance to ride completion and CSV export.</p>
                    </div>
                </div>
                
                <div class="diagram-container">
                    <div class="mermaid">
graph TB
    Start([Passenger wants a ride]) --> Login1{Logged in?}
    
    Login1 -->|No| Register[Register with<br/>university email]
    Register --> Verify[Verify email]
    Verify --> Login1
    
    Login1 -->|Yes| CreateRequest[Fill ride request form:<br/>- Origin<br/>- Destination<br/>- Time<br/>- Seats needed]
    
    CreateRequest --> Validate{Input valid?}
    Validate -->|No| ShowError1[Show validation errors]
    ShowError1 --> CreateRequest
    
    Validate -->|Yes| Calculate[Calculate price estimate<br/>distance √ó base_rate]
    Calculate --> SaveRequest[Save ride to DB<br/>status = PENDING]
    SaveRequest --> WaitDriver[Wait for driver to accept]
    
    WaitDriver --> Timeout{24h passed?}
    Timeout -->|Yes| AutoCancel[Auto-cancel ride]
    AutoCancel --> End1([Ride cancelled])
    
    Timeout -->|No| DriverCheck{Driver views<br/>open requests?}
    
    DriverCheck -->|No| WaitDriver
    
    DriverCheck -->|Yes| DriverLogin{Driver<br/>logged in?}
    DriverLogin -->|No| DriverReg[Driver registers<br/>and adds car]
    DriverReg --> DriverLogin
    
    DriverLogin -->|Yes| ViewRequests[Driver sees list of<br/>PENDING rides]
    ViewRequests --> SelectRide[Driver selects a ride]
    SelectRide --> ChooseCar[Driver chooses which car to use]
    
    ChooseCar --> CheckCapacity{Car capacity >=<br/>seats needed?}
    
    CheckCapacity -->|No| ErrorCapacity[Show error:<br/>CapacityExceededException]
    ErrorCapacity --> ChooseCar
    
    CheckCapacity -->|Yes| AcceptRide[Assign driver & car to ride<br/>status = CONFIRMED]
    AcceptRide --> NotifyPassenger[Notify passenger:<br/>Driver found!]
    NotifyPassenger --> RideDay[Wait for scheduled time]
    
    RideDay --> Pickup[Driver picks up passenger]
    Pickup --> Complete[Driver marks<br/>ride COMPLETED]
    Complete --> UpdateDB[Update ride status in DB]
    UpdateDB --> ExportOption{Want to export<br/>history?}
    
    ExportOption -->|Yes| ExportCSV[Export rides to CSV]
    ExportCSV --> End2([Done])
    
    ExportOption -->|No| End2
    
    style Start fill:#e1f5ff
    style End1 fill:#ffcccc
    style End2 fill:#ccffcc
    style CreateRequest fill:#fff4e1
    style AcceptRide fill:#ccffcc
    style ErrorCapacity fill:#ffcccc
                    </div>
                </div>
                
                <div class="implementation-notes">
                    <h3>‚úÖ Implementation Checklist</h3>
                    <ul>
                        <li><strong>Email Validation:</strong> Must contain @student.ie.edu or @ie.edu</li>
                        <li><strong>Capacity Check:</strong> Validate before accepting ride</li>
                        <li><strong>Auto-Cancel:</strong> Background job to cancel PENDING rides after 24h</li>
                        <li><strong>CSV Export:</strong> Simple file I/O functionality</li>
                        <li><strong>Error Handling:</strong> Custom exceptions at key points</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <footer>
            <h3>TeeTime - Campus Ride-Sharing Platform</h3>
            <p><strong>Phase 1 Core Implementation</strong></p>
            <p style="margin-top: 10px; font-size: 0.9em; opacity: 0.8;">
                Focused on essential Passenger-Driver matching workflow<br/>
                13+ classes | 3 database tables | JavaFX GUI | File I/O | Exception handling | Unit tests
            </p>
            <p style="margin-top: 15px; font-size: 0.85em;">
                <strong>Satisfies all course requirements while keeping implementation lean and achievable!</strong>
            </p>
        </footer>
    </div>
    
    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            securityLevel: 'loose',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });
        
        function showDiagram(diagramId) {
            const sections = document.querySelectorAll('.diagram-section');
            sections.forEach(section => section.classList.remove('active'));
            
            const selectedSection = document.getElementById(diagramId + '-diagram');
            if (selectedSection) {
                selectedSection.classList.add('active');
            }
            
            const buttons = document.querySelectorAll('nav button');
            buttons.forEach(button => button.classList.remove('active'));
            event.target.classList.add('active');
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        document.addEventListener('keydown', function(e) {
            const diagrams = ['class', 'er', 'usecase', 'sequence', 'architecture', 'state', 'activity'];
            const currentActive = document.querySelector('.diagram-section.active');
            const currentId = currentActive.id.replace('-diagram', '');
            const currentIndex = diagrams.indexOf(currentId);
            
            if (e.key === 'ArrowRight' && currentIndex < diagrams.length - 1) {
                const buttons = document.querySelectorAll('nav button');
                buttons[currentIndex + 1].click();
            } else if (e.key === 'ArrowLeft' && currentIndex > 0) {
                const buttons = document.querySelectorAll('nav button');
                buttons[currentIndex - 1].click();
            }
        });
    </script>
</body>
</html>
